name: Compile Examples

on:
  push:
  pull_request:

jobs:
  build:
    runs-on: ubuntu-22.04
    strategy:
      fail-fast: false
      matrix:
        compiler: [gcc-11, gcc-12, gcc-13, clang-14, clang-15]

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Install compiler
        run: |
          sudo apt-get update
          if [[ "${{ matrix.compiler }}" == gcc-* ]]; then
            version="${{ matrix.compiler }}"
            version="${version#gcc-}"
            sudo apt-get install -y "g++-${version}"
            echo "CXX=g++-${version}" >> "$GITHUB_ENV"
          else
            version="${{ matrix.compiler }}"
            version="${version#clang-}"
            sudo apt-get install -y "clang-${version}"
            echo "CXX=clang++-${version}" >> "$GITHUB_ENV"
          fi

      - name: Compile all examples
        run: |
          echo "Using compiler: $CXX"
          for file in exemples/*.cpp; do
            echo "Compiling $file"
            $CXX -std=c++20 -Wall -Wextra -Wpedantic -Werror "$file" -o "${file%.cpp}"
          done

      # Optionnel : exécuter les binaires si aucune entrée n'est requise.
